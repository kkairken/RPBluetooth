# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω –ø–æ Bluetooth

–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —á–µ—Ä–µ–∑ –º–æ–±–∏–ª—å–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω.

---

## üì± –í–ê–†–ò–ê–ù–¢–´ –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–µ BLE –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–°–ê–ú–´–ô –ü–†–û–°–¢–û–ô)
‚è±Ô∏è –í—Ä–µ–º—è: 5-10 –º–∏–Ω—É—Ç –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å: –ë–µ—Å–ø–ª–∞—Ç–Ω–æ
üîß –°–ª–æ–∂–Ω–æ—Å—Ç—å: –ù–∏–∑–∫–∞—è

### –í–∞—Ä–∏–∞–Ω—Ç 2: Python —Å–∫—Ä–∏–ø—Ç —Å bleak (–¥–ª—è Android/–∫–æ–º–ø—å—é—Ç–µ—Ä–∞)
‚è±Ô∏è –í—Ä–µ–º—è: 15 –º–∏–Ω—É—Ç –Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫—É + —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å: –ë–µ—Å–ø–ª–∞—Ç–Ω–æ
üîß –°–ª–æ–∂–Ω–æ—Å—Ç—å: –°—Ä–µ–¥–Ω—è—è

### –í–∞—Ä–∏–∞–Ω—Ç 3: –†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚è±Ô∏è –í—Ä–µ–º—è: –ù–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å: –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
üîß –°–ª–æ–∂–Ω–æ—Å—Ç—å: –í—ã—Å–æ–∫–∞—è

---

## üöÄ –í–ê–†–ò–ê–ù–¢ 1: –ì–æ—Ç–æ–≤—ã–µ BLE –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ BLE –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω

**–î–ª—è iOS**:
- **LightBlue** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) - https://apps.apple.com/app/lightblue/id557428110
- **nRF Connect** - https://apps.apple.com/app/nrf-connect/id1054362403

**–î–ª—è Android**:
- **nRF Connect** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) - https://play.google.com/store/apps/details?id=no.nordicsemi.android.mcp
- **BLE Scanner** - https://play.google.com/store/apps/details?id=com.macdom.ble.blescanner

### –®–∞–≥ 2: –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–π BLE —Å–µ—Ä–≤–µ—Ä –Ω–∞ Raspberry Pi

‚ö†Ô∏è **–í–ê–ñ–ù–û**: –°–µ–π—á–∞—Å BLE —Å–µ—Ä–≤–µ—Ä –≤ mock —Ä–µ–∂–∏–º–µ –∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!

**–ù—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π BLE —Å–µ—Ä–≤–µ—Ä:**

```bash
# –ù–∞ Raspberry Pi
sudo apt install -y bluez bluetooth libbluetooth-dev python3-dbus python3-gi

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ bleak –¥–ª—è Python BLE
source venv/bin/activate
pip install bleak dbus-python

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Bluetooth
sudo systemctl status bluetooth
hciconfig
```

### –®–∞–≥ 3: –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–π BLE —Å–µ—Ä–≤–µ—Ä

–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —Ç–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è - —ç—Ç–æ mock. –î–ª—è —Ä–∞–±–æ—Ç—ã –Ω—É–∂–Ω–æ:

**–ü–†–û–ë–õ–ï–ú–ê**: `src/ble_server.py` –Ω–∞ —Å—Ç—Ä–æ–∫–∞—Ö 422-473 - —ç—Ç–æ –∑–∞–≥–ª—É—à–∫–∞.

**–†–ï–®–ï–ù–ò–ï**: –ù—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –Ω–∞—Å—Ç–æ—è—â–∏–π BLE GATT —Å–µ—Ä–≤–µ—Ä –∏—Å–ø–æ–ª—å–∑—É—è `bleak` –∏–ª–∏ `bluezero`.

---

## ‚ö° –ë–´–°–¢–†–û–ï –†–ï–®–ï–ù–ò–ï: –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å –∫–æ–º–ø—å—é—Ç–µ—Ä–∞

–ü–æ–∫–∞ –Ω–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ BLE —Å–µ—Ä–≤–µ—Ä–∞, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–ø—Ä—è–º—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç**:

### –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å —Ñ–æ—Ç–æ

```bash
# –ù–∞ Raspberry Pi
source venv/bin/activate

# –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ 2-3 —Ñ–æ—Ç–æ
# –§–æ—Ç–æ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ JPEG

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
python tools/register_employee_direct.py \
  --employee-id "EMP001" \
  --display-name "–ê–¥–∏–ª—å –•–∞–Ω" \
  --access-start "2025-01-01T00:00:00Z" \
  --access-end "2026-12-31T23:59:59Z" \
  --photos photo1.jpg photo2.jpg photo3.jpg
```

–°–æ–∑–¥–∞–º —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –¥–ª—è –≤–∞—Å...

---

## üíª –í–ê–†–ò–ê–ù–¢ 2: Python —Å–∫—Ä–∏–ø—Ç —Å bleak

–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å Android —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏–ª–∏ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ —á–µ—Ä–µ–∑ Bluetooth.

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Python 3.10+ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ/–∫–æ–º–ø—å—é—Ç–µ—Ä–µ —Å BLE
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π `bleak`
- Raspberry Pi —Å –∑–∞–ø—É—â–µ–Ω–Ω—ã–º BLE —Å–µ—Ä–≤–µ—Ä–æ–º

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä/—Ç–µ–ª–µ—Ñ–æ–Ω

```bash
# –ù–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ –∏–ª–∏ Android —Å Termux
pip install bleak pillow

# –°–∫–∞—á–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç ble_register_client.py (—Å–æ–∑–¥–∞–º –Ω–∏–∂–µ)
```

–°–æ–∑–¥–∞–º —Å–∫—Ä–∏–ø—Ç –¥–ª—è BLE –∫–ª–∏–µ–Ω—Ç–∞...

---

## üì± –í–ê–†–ò–ê–ù–¢ 3: –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (Flutter/React Native)

–î–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω—É–∂–Ω–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```
mobile_app/
‚îú‚îÄ‚îÄ screens/
‚îÇ   ‚îú‚îÄ‚îÄ scan_devices.dart       # –ü–æ–∏—Å–∫ Raspberry Pi
‚îÇ   ‚îú‚îÄ‚îÄ register_employee.dart  # –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ take_photos.dart        # –ö–∞–º–µ—Ä–∞ –¥–ª—è —Ñ–æ—Ç–æ
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ ble_service.dart        # BLE –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ hmac_service.dart       # HMAC –ø–æ–¥–ø–∏—Å—å
‚îî‚îÄ‚îÄ models/
    ‚îî‚îÄ‚îÄ employee.dart           # –ú–æ–¥–µ–ª—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
```

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
- **Flutter** + `flutter_blue_plus` (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- **React Native** + `react-native-ble-plx`
- **Native iOS/Android** + CoreBluetooth/Android BLE API

---

## üîß –í–†–ï–ú–ï–ù–ù–û–ï –†–ï–®–ï–ù–ò–ï: –ü—Ä—è–º–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –±–µ–∑ BLE

–î–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ BLE —Å–µ—Ä–≤–µ—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ **–ø—Ä—è–º—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é**.

### –ú–µ—Ç–æ–¥ 1: –ß–µ—Ä–µ–∑ Python —Å–∫—Ä–∏–ø—Ç (–Ω–∞ —Å–∞–º–æ–π Raspberry Pi)

–°–æ–∑–¥–∞–º —Å–∫—Ä–∏–ø—Ç `tools/register_employee_direct.py`:

```python
#!/usr/bin/env python3
"""
–ü—Ä—è–º–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –±–µ–∑ BLE.
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏ —Å–∏—Å—Ç–µ–º–µ.
"""
import sys
sys.path.insert(0, 'src')

import argparse
from datetime import datetime
from pathlib import Path
import cv2
import numpy as np

from db import Database
from face.detector import FaceDetector
from face.align import FaceAligner
from face.embedder_onnx import FaceEmbedder
from face.quality import FaceQualityChecker

def register_employee(
    employee_id: str,
    display_name: str,
    access_start: str,
    access_end: str,
    photo_paths: list,
    config_path: str = "config/usb_config.yaml"
):
    """–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏."""

    print(f"üîÑ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: {employee_id} ({display_name})")

    # –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
    from config import load_config
    config = load_config(config_path)

    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
    db = Database(config.database.path)
    detector = FaceDetector(
        detector_type=config.face.detector_type,
        scale_factor=config.face.detector_scale_factor,
        min_neighbors=config.face.detector_min_neighbors,
        min_face_size=config.face.detector_min_face_size
    )
    aligner = FaceAligner(output_size=(112, 112))
    embedder = FaceEmbedder(
        model_path=config.face.onnx_model_path,
        embedding_dim=config.face.embedding_dim
    )
    quality_checker = FaceQualityChecker(
        min_face_size=config.face.quality_min_face_size,
        blur_threshold=config.face.quality_blur_threshold
    )

    # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
    embeddings = []
    for i, photo_path in enumerate(photo_paths):
        print(f"\nüì∏ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ {i+1}/{len(photo_paths)}: {photo_path}")

        # –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        frame = cv2.imread(photo_path)
        if frame is None:
            print(f"   ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å {photo_path}")
            continue

        # –î–µ—Ç–µ–∫—Ü–∏—è –ª–∏—Ü–∞
        faces = detector.detect(frame)
        if not faces:
            print(f"   ‚ùå –õ–∏—Ü–æ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ")
            continue

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞
        valid, reason = quality_checker.validate_for_registration(frame, faces)
        if not valid:
            print(f"   ‚ö†Ô∏è  –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: {reason}")
            # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –¥–∞–∂–µ –µ—Å–ª–∏ –∫–∞—á–µ—Å—Ç–≤–æ –Ω–µ –∏–¥–µ–∞–ª—å–Ω–æ–µ

        # –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ
        aligned = aligner.align(frame, faces[0])
        if aligned is None:
            print(f"   ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã—Ä–æ–≤–Ω—è—Ç—å –ª–∏—Ü–æ")
            continue

        # –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∞
        embedding = embedder.compute_embedding(aligned)
        if embedding is None:
            print(f"   ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã—á–∏—Å–ª–∏—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥")
            continue

        embeddings.append(embedding)
        print(f"   ‚úÖ –≠–º–±–µ–¥–¥–∏–Ω–≥ –∏–∑–≤–ª–µ—á—ë–Ω (—Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å: {len(embedding)})")

    if not embeddings:
        print("\n‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å –Ω–∏ –æ–¥–Ω–æ–≥–æ —ç–º–±–µ–¥–¥–∏–Ω–≥–∞!")
        return False

    print(f"\n‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–æ {len(embeddings)} —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤")

    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
    print("\nüíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö...")

    # –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞—Ç
    start_dt = datetime.fromisoformat(access_start.replace('Z', '+00:00'))
    end_dt = datetime.fromisoformat(access_end.replace('Z', '+00:00'))

    # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
    db.upsert_employee(
        employee_id=employee_id,
        access_start=start_dt,
        access_end=end_dt,
        display_name=display_name,
        is_active=True
    )
    print(f"   ‚úÖ –°–æ—Ç—Ä—É–¥–Ω–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω: {employee_id}")

    # –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
    db.delete_embeddings(employee_id)

    # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
    for emb in embeddings:
        db.add_embedding(employee_id, emb)
    print(f"   ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ {len(embeddings)} —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤")

    db.close()

    print(f"\nüéâ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!")
    print(f"   ID: {employee_id}")
    print(f"   –ò–º—è: {display_name}")
    print(f"   –ü–µ—Ä–∏–æ–¥ –¥–æ—Å—Ç—É–ø–∞: {access_start} - {access_end}")
    print(f"   –≠–º–±–µ–¥–¥–∏–Ω–≥–æ–≤: {len(embeddings)}")

    return True

def main():
    parser = argparse.ArgumentParser(
        description='–ü—Ä—è–º–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ (–±–µ–∑ BLE)'
    )
    parser.add_argument('--employee-id', required=True, help='ID —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞')
    parser.add_argument('--display-name', required=True, help='–ò–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞')
    parser.add_argument('--access-start', required=True, help='–ù–∞—á–∞–ª–æ –¥–æ—Å—Ç—É–ø–∞ (ISO 8601)')
    parser.add_argument('--access-end', required=True, help='–ö–æ–Ω–µ—Ü –¥–æ—Å—Ç—É–ø–∞ (ISO 8601)')
    parser.add_argument('--photos', nargs='+', required=True, help='–ü—É—Ç–∏ –∫ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º')
    parser.add_argument('--config', default='config/usb_config.yaml', help='–ü—É—Ç—å –∫ –∫–æ–Ω—Ñ–∏–≥—É')

    args = parser.parse_args()

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
    for photo in args.photos:
        if not Path(photo).exists():
            print(f"‚ùå –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {photo}")
            sys.exit(1)

    success = register_employee(
        employee_id=args.employee_id,
        display_name=args.display_name,
        access_start=args.access_start,
        access_end=args.access_end,
        photo_paths=args.photos,
        config_path=args.config
    )

    sys.exit(0 if success else 1)

if __name__ == '__main__':
    main()
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–º –≤ —Å–ª–µ–¥—É—é—â–µ–º —Å–æ–æ–±—â–µ–Ω–∏–∏.

---

## üìù –ü—Ä–æ—Ç–æ–∫–æ–ª BLE (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)

### UUID —Å–µ—Ä–≤–∏—Å–∞ –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫

```
Service UUID:        12345678-1234-5678-1234-56789abcdef0
Command Char UUID:   12345678-1234-5678-1234-56789abcdef1 (Write)
Response Char UUID:  12345678-1234-5678-1234-56789abcdef2 (Notify)
```

### –ü—Ä–æ—Ü–µ—Å—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

1. **–ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ Raspberry Pi —á–µ—Ä–µ–∑ BLE**
2. **–û—Ç–ø—Ä–∞–≤—å—Ç–µ BEGIN_UPSERT** —Å HMAC –ø–æ–¥–ø–∏—Å—å—é
3. **–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏** —á–∞–Ω–∫–∞–º–∏ (512 –±–∞–π—Ç)
4. **–û—Ç–ø—Ä–∞–≤—å—Ç–µ END_UPSERT** –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

–ü–æ–¥—Ä–æ–±–Ω–æ —Å–º. `API_REFERENCE.md`

---

## ‚úÖ –ß–¢–û –î–ï–õ–ê–¢–¨ –°–ï–ô–ß–ê–°

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (—Å–µ–≥–æ–¥–Ω—è):

1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç `register_employee_direct.py` (—Å–æ–∑–¥–∞–º –Ω–∏–∂–µ)
2. –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –Ω–∞–ø—Ä—è–º—É—é –Ω–∞ Raspberry Pi

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (—ç—Ç–∞ –Ω–µ–¥–µ–ª—è):

1. –†–µ–∞–ª–∏–∑—É–π—Ç–µ –Ω–∞—Å—Ç–æ—è—â–∏–π BLE —Å–µ—Ä–≤–µ—Ä —Å `bleak`
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ nRF Connect –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (–Ω–µ–¥–µ–ª–∏):

1. –†–∞–∑—Ä–∞–±–æ—Ç–∞–π—Ç–µ –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω

---

## üÜò –ù–£–ñ–ù–ê –ü–û–ú–û–©–¨?

**–í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–π –ø—É—Ç—å:**

‚úÖ **"–ú–Ω–µ –Ω—É–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –ª—é–¥–µ–π"**
   ‚Üí –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `register_employee_direct.py`

‚úÖ **"–•–æ—á—É —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω, –Ω–æ –Ω–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"**
   ‚Üí –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ nRF Connect + —Ä–µ–∞–ª–∏–∑—É–π—Ç–µ –Ω–∞—Å—Ç–æ—è—â–∏–π BLE —Å–µ—Ä–≤–µ—Ä

‚úÖ **"–•–æ—á—É –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–µ –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"**
   ‚Üí –ù–∞–π–º–∏—Ç–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∏–ª–∏ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ —Å–∞–º–∏

---

–Ø —Å–æ–∑–¥–∞–º —Å–∫—Ä–∏–ø—Ç `register_employee_direct.py` –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏!
